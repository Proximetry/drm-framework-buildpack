#! /bin/sh

BUILD_DIR=$1
ERL=${BUILD_DIR}/bin/erl

sed -i 's/^ROOTDIR=.*$/ROOTDIR=$HOME/g' $ERL
sed -i 's/^BINDIR=.*$/BINDIR=$ROOTDIR\/bin/g' $ERL

sed -i '/java.*@127.0.0.1/d' $BUILD_DIR/sys.config

# change 'options, []' to 'options, [\n]'
sed -i 's/options, \[\ *\]/options, \[\r\n        \]/g' $BUILD_DIR/log.config
# add {log_to_stdout, true} to log.config options
sed -i '/options, \[/a\            \{log_to_stdout, true\}' $BUILD_DIR/log.config
# add comma if {log_to_stdout, true} is not the last entry within options (there exists next line with option or comment after {log_to_stdout, true})
sed -i '/{log_to_stdout, true}/{N; s/\({log_to_stdout, true}\)\n\(\ *[{%].*\)/\1,\n\2/}' $BUILD_DIR/log.config

exit 0
